# Debian-based image makes building easier than alpine
FROM postgres:17

# Build deps
RUN apt-get update && apt-get install -y \
    git build-essential cmake \
    libcurl4-openssl-dev uuid-dev \
    postgresql-server-dev-17 \
 && rm -rf /var/lib/apt/lists/*

# Build & install clickhouse_fdw
RUN git clone --depth 1 https://github.com/ildus/clickhouse_fdw.git /tmp/clickhouse_fdw \
 && cd /tmp/clickhouse_fdw && mkdir build && cd build \
 && cmake .. && make -j"$(nproc)" && make install \
 && rm -rf /tmp/clickhouse_fdw

# Nothing else needed: CREATE EXTENSION will find the shared library
